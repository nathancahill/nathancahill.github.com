
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>Nathan Cahill</title>
	<meta name="author" content="Nathan Cahill">

	
	<meta name="description" content="As much as we live in an overly connected world, our data online lives in seperate silos. Everything is locked down behind logins and API-less &hellip;">
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="Nathan Cahill" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<script type="text/javascript" src="//use.typekit.net/dqs7xdv.js"></script>
<script type="text/javascript">try{Typekit.load();}catch(e){}</script>
</head>

<body>
	<header id="header" class="inner"><h1><a href="/">Nathan Cahill</a></h1>
<nav id="main-nav"><ul class="main">
	<li><a href="/blog/archives">Archives</a></li>
	<li><a href="http://www.nathancahill.com">Website + Portfolio</a></li>
	<li><a href="https://github.com/nathancahill">Github</a></li>
	<li><a href="https://twitter.com/nathancahill">Twitter</a></li>
</ul>
</nav>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul class="main">
	<li><a href="/blog/archives">Archives</a></li>
	<li><a href="http://www.nathancahill.com">Website + Portfolio</a></li>
	<li><a href="https://github.com/nathancahill">Github</a></li>
	<li><a href="https://twitter.com/nathancahill">Twitter</a></li>
</ul>
</div>
	</div>
	<div class="alignright search">
		<a class="button"></a>
		<div class="container">
			<form action="http://google.com/search" method="get">
				<input type="text" name="q" results="0">
				<input type="hidden" name="q" value="site:nathancahill.github.com">
			</form>
		</div>
	</div>
</nav>
<nav id="sub-nav" class="alignright">
	<div class="social">
		
		
		
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
	</div>
	<form class="search" action="http://google.com/search" method="get">
		<input class="alignright" type="text" name="q" results="0">
		<input type="hidden" name="q" value="site:nathancahill.github.com">
	</form>
</nav>

</header>
	
		
	
	<div id="content" class="inner">


    <article class="post">
	<div class="date">








  


<time datetime="2012-10-16T06:08:00-04:00" pubdate data-updated="true">Oct 16<span>th</span>, 2012</time></div>
	<h1 class="title"><a href="/connecting-things-that-are-inherently-disconnected/">Connecting Things That Are Inherently Disconnected</a></h1>
	<div class="entry-content">
		<p>As much as we live in an overly connected world, our data online lives in seperate silos. Everything is locked down behind logins and API-less websites. That’s why startups and web apps that connect these disconnected silos are so exciting to me. I’m a huge fan of <a href="http://ifttt.com/">IFTTT</a>. <a href="http://www.olark.com/">Olark</a>. <a href="http://thread.is/">Thread.is</a>. <a href="http://zapier.com/">Zapier</a>. <a href="http://rapportive.com/">Rapportive</a>. <a href="https://www.filepicker.io/">Filepicker.io</a>. <a href="http://hellofax.com/">HelloFax</a>. <a href="http://boxcar.io/">Boxcar</a>. <a href="https://card.io/">Card.io</a>. <a href="https://www.easypost.co/">EasyPost</a>. <a href="http://lessneglect.com/">Less Neglect</a>. <a href="http://www.instapaper.com/">Instapaper</a>. <a href="http://www.timbreapp.com/">Timbre</a>.</p>

<p>The common theme here is that these apps accomplish things that we feel we should be able to do. After all, our services and data are in the cloud and should be able to tap in to each other. Sometimes it reminds me of a misconfigured router in my networking class years ago: no matter how hard I try, I can’t ping the IP of the computer next to me.</p>

<p>This part of the internet is broken. It’s about time we start to fix it.</p>

		
		
	</div>
</article>


    <article class="post">
	<div class="date">








  


<time datetime="2012-10-14T06:22:00-04:00" pubdate data-updated="true">Oct 14<span>th</span>, 2012</time></div>
	<h1 class="title"><a href="/jit-architecture-scaling/">Just-In-Time Architecture Scaling</a></h1>
	<div class="entry-content">
		<p>Any discussion about the architecture of a software project leads to
arguments over the best way to achieve scalability. Essentially, it comes down to
finding a happy medium between the <strong>time required</strong> to develop a scalable
architecture and <strong>how scalable</strong> that architecture will be.</p>

<p>On one theoretical extreme, we could build a simple prototype of our software
over the weekend, capable of supporting 100 users. Once we pass 100 users, we
would have to restructure the architecture. On the other side, we could spend a
year building rock solid software, capable of supporting 100 million users.</p>

<p>This is where the idea of <strong>Just-In-Time</strong> (JIT) scaling comes in. Once you&#8217;ve
reached a certain amount of users on the first iteration, you can afford to
spend more time developing the next iteration. Scaling can be done through
iterations. <strong>Avoid premature optimization</strong>.</p>

<p>Facebook first ran on PHP and Twitter ran on Rails. Stackoverflow used C#.
Although the choices of language or database are the most often questioned at
the initial stage, these are not very important questions. <strong>Build with the
stack that you know</strong>. Reaching the limits of the stack used in the first
iteration is A Good Problem to have.</p>

<p>Even before you reach the limits of iteration one, you can start development
on a more robust, scalable architecture. By always building &#8221;<a href="http://www.codingthearchitecture.com/pages/book/just-enough-architecture.html">just enough</a>&#8221;,
you can minimize development time while staying ahead of the scalability curve.
Keep in mind that, no matter what scripting language the prototype was built in,
once your software scales to hundreds of thousands of users, you will likely be
running on heavily optimized low-level code.</p>

<p>Of course, there&#8217;s no need to completely rewrite your entire codebase every time
your growth multiplies. By modularizing development of different components, and
by using internal APIs and queues, you can <strong>scale distinct parts</strong> of the
software independently. These design questions are the questions that are
important to ask.</p>

		
		
	</div>
</article>


    <article class="post">
	<div class="date">








  


<time datetime="2012-10-13T02:39:00-04:00" pubdate data-updated="true">Oct 13<span>th</span>, 2012</time></div>
	<h1 class="title"><a href="/pro-tip-manage-cron-like-a-boss/">Pro Tip: Manage Cron Like a Boss</a></h1>
	<div class="entry-content">
		<p>Managing cron can be a little intimidating to the uninitiated. How do you
load jobs in to cron? How do you know what&#8217;s running? How can you check on each
job&#8217;s status? It&#8217;s a pity that the first tutorial result on Google for cron was
written in 1999. A lot of what it recommends is outdated. For the most part, you
should never have to mess with /etc/crontab. This is the system crontab, don&#8217;t
touch it unless you know what you&#8217;re doing.</p>

<h2>Easiest way to load new jobs</h2>

<p>Create a file called .cron in your home folder. Edit the list of cron jobs
in this file, then load it in to cron with the crontab command:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ crontab ~/.cron</span></code></pre></td></tr></table></div></figure>


<p>Note: This clears all existing jobs. Back them up first with the command below.</p>

<h2>Easiest way to see what&#8217;s already loaded</h2>

<p>If you want to check what jobs are already loaded in cron, or generate a .cron
file for the first time, run:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ crontab -l</span></code></pre></td></tr></table></div></figure>


<p>Optionally output this to the .cron file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ crontab -l &gt; ~/.cron</span></code></pre></td></tr></table></div></figure>


<h2>Easiest way to check a job&#8217;s status</h2>

<p><img class="right" src="https://deadmanssnitch.com/assets/screenshot-800.png" width="600" height="372"></p>

<p>With cron&#8217;s default settings on most machines, this isn&#8217;t an easy one. On
Ubuntu, cron messages are logged to the /var/log/syslog file. There&#8217;s ways to
set up logs for each cron job, but if you just want a simple way to make sure
your nightly backups are running, check out
<a href="https://deadmanssnitch.com/">Dead Man&#8217;s Snitch</a>.</p>

<p>DMS is an awesome web app that shows the status of each of your cron jobs, and
how long ago it last ran. It does cost $19/month for more than one job, but if
you aren&#8217;t handy with the command line, it&#8217;s worth it to keep an eye on your
cron jobs.</p>

<p>All you have to do is add a curl request to a unique URL after each cron job
runs. Dead simple:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ run_backup && curl https://nosnch.in/34ljkh3d</span></code></pre></td></tr></table></div></figure>


<p>If you have any questions about Dead Man&#8217;s Snitch, send a tweet to
<a href="https://twitter.com/DeadMansSnitch">@DeadMansSnitch</a>. They are awesome.
If you have questions about cron, cron jobs, or anything else, feel free to
tweet me <a href="https://twitter.com/nathancahill">@nathancahill</a>.</p>

<p>Cron is a powerful tool, and once you understand how it works, it&#8217;s easy to use.
Now, go ahead and cron ALL OF THE THINGS!</p>

		
		
	</div>
</article>


    <article class="post">
	<div class="date">








  


<time datetime="2012-10-12T05:51:00-04:00" pubdate data-updated="true">Oct 12<span>th</span>, 2012</time></div>
	<h1 class="title"><a href="/photoshop-in-memory-scratch-disk/">Photoshop In-memory Scratch Disk</a></h1>
	<div class="entry-content">
		<p>After getting a new Macbook Pro with 16GB of RAM (<a href="http://www.newegg.com/Product/Product.aspx?Item=N82E16820231576">G.Skill</a>, not from Apple, highly recommended),
I starting looking for ways to put it to use. One of my favorite hacks is
mounting a virtual disk with a portion of the RAM. Once you create a RAM disk, you
can take advantage of the <a href="http://en.wikipedia.org/wiki/DDR3_SDRAM#Modules">theoretical 10GB/s read/write speed</a> to RAM.
Everything stored in the RAM is temporary and will disappear on unmount or reboot.</p>

<p>It&#8217;s pretty simple to do, just run this command in the Terminal:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ diskutil erasevolume HFS+ "ramdisk" `hdiutil attach -nomount ram://4194304`
</span></code></pre></td></tr></table></div></figure>


<p>The number at the end of the command is the number of 512 byte sectors
for the disk. For a 2GB disk: 2GB = 2147483648 bytes. 2147483648 / 512 = 4194304 disk sectors.</p>

<p>After that, you can set Photoshop&#8217;s scratch disk to ramdisk. One caveat is that
you&#8217;ll need to run the command every time you restart the computer. So drop it
in an Automator app and add it to your Startup Items.</p>

<p><img src="http://nathancahill.github.com/images/automator.png"></p>

<p>Some other cool things you can do with a very fast, but temporary disk:</p>

<ul>
<li>Store a working copy of large files for instant access</li>
<li>Run <a href="http://www.freesmug.org/portableapps">portable apps</a> entirely in the memory</li>
<li>Get a small linux distro like <a href="http://puppylinux.org/main/Overview%20and%20Getting%20Started.htm">Puppy Linux</a>
and running it from a VM. Entire operating system in memory.</li>
</ul>


<p>Have another cool use for an in-memory disk? Comment below or tweet me <a href="https://twitter.com/nathancahill">@nathancahill</a>.</p>

		
		
	</div>
</article>


    <article class="post">
	<div class="date">








  


<time datetime="2012-09-24T20:14:00-04:00" pubdate data-updated="true">Sep 24<span>th</span>, 2012</time></div>
	<h1 class="title"><a href="/hackers-and-hustlers-where-next/">Hackers and Hustlers: Where Next?</a></h1>
	<div class="entry-content">
		<p><img class="left" src="http://f.cl.ly/items/3d042x1j1X2d0B0C1z1i/hh-sticker.png" width="110" height="110"></p>

<p>As we&#8217;re getting close to 1000 users on Hackers and Hustlers, I&#8217;d like to start a discussion about the future of H&amp;H.</p>

<p>We used to have excellent discussions on here. A year ago and 600 people less, it was not unusual to see 40+ comment discussions, there was even talk of Facebook needing threading in comments. We were opinionated and expressive. Links posted tended to be relevant to the group&#8217;s goal: creating a startup culture in Michigan.</p>

<p>Lately, H&amp;H has been swamped by all kinds of link posts and very little discussion or response. The volume of posts has more than tripled, but discussion and participation has decreased inversely. And the Start Garden endorsement requests are starting to feel like Farmville spam.</p>

<p>I know that this is a well documented phenomena in online communities. Digg, Youtube, Slashdot, Reddit and Hacker News have all followed the same pattern. What starts as a curated or exclusive ecosystem (and quickly gains popularity because of that), is inevitably degrade to chatter and spam.</p>

<p>Nathan Bashaw and I talked several times at the beginning of this year about the direction H&amp;H was heading. We had just hit 600 members and it was the only reason that I ever logged in to Facebook. We talked about the possibility of H&amp;H growing too big for itself, but we hoped that quality discussions and links would float to the top. Instead, they seems to get buried too quickly.</p>

<p>What&#8217;s next? Where do we go from here? We are still a solid community of michiganders, hacking and hustling our way through the startup life. Props to Bashaw for adding Kyle Mulka, Ryan Goins and Nate West as admins. You&#8217;ve all been doing a great job keeping everything running smoothly. And I&#8217;m excited for the H&amp;H stickers too, they are awesome. If you haven&#8217;t yet, go check them out <a href="https://www.facebook.com/groups/hackersandhustlers/permalink/433723686664757/">here</a>.</p>

<p>So here&#8217;s what I suggest: Let&#8217;s participate more in discussions and let&#8217;s post stuff that&#8217;s more relevant to the group. Let&#8217;s see the projects you guys are working on, instead of the latest trend on HN! Don&#8217;t just ask for an endorsement on Start Garden, post a Show H&amp;H of your prototype or even just your landing page. Give feedback, mentor, and encourage others. And for gods sake, post jobs to hackersandhustlers.org. Thoughtful discussion online (gasp) is not dead!</p>

		
		
	</div>
</article>


    <article class="post">
	<div class="date">








  


<time datetime="2012-09-24T03:28:00-04:00" pubdate data-updated="true">Sep 24<span>th</span>, 2012</time></div>
	<h1 class="title"><a href="/circus/">Circus, Nginx and Websockets</a></h1>
	<div class="entry-content">
		<p>Looking for a high performance, powerfull process manager for a Python project I&#8217;m working on, I stumbled on <a href="http://circus.io/">Circus</a> on this <a href="http://blog.ziade.org/2012/06/28/wgsi-web-servers-bench/">excellent benchmark blog post</a>. After running my own benchmark tests, I agree that the <a href="http://circus.io/">Circus</a> + <a href="http://chaussette.readthedocs.org">Chaussette</a> + <a href="http://meinheld.org/">Meinheld</a> stack is the way to go. High concurrency, fast response time, and socket support are the features that pulled me in. I&#8217;m switching off of <a href="http://supervisord.org/">Supervisord</a>, because: a) Circus integrates directly with <a href="http://zeromq.org/">ZeroMQ</a>, and b) <a href="http://gunicorn.org/">Gunicorn</a> + Supervisord requires two levels of process management: Supervisor controls gunicorn, and gunicorn in turn watching it&#8217;s own worker processes. Circus keeps everything on the same level.</p>

<p><a href="http://circus.readthedocs.org/">circus.readthedocs.org</a> has excellent documentation for getting started with Circus. I did run in to a couple caveats though:</p>

<h2>Circus doesn&#8217;t start on boot</h2>

<p>I started testing Circus in the command line by running <code>circusd circus.ini</code>. I quickly switched to running it as a service in Upstart, using this <code>etc/init/circus.conf</code> file:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">start</span> <span class="n">on</span> <span class="n">filesystem</span> <span class="ow">and</span> <span class="n">net</span><span class="o">-</span><span class="n">device</span><span class="o">-</span><span class="n">up</span> <span class="n">IFACE</span><span class="o">=</span><span class="n">lo</span>
</span><span class='line'><span class="k">exec</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">circusd</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">circus</span><span class="o">.</span><span class="n">ini</span>
</span></code></pre></td></tr></table></div></figure>


<p>This script just waits for the file system and networking to become available, then it runs <code>circusd</code> with my config file in <code>/etc/circus.ini</code>. Easy enough.</p>

<h2>Getting Circus workers to work with virtual environments</h2>

<p>Although Circus workers have awesome properties like env, copy_env and copy_path (which all work great when running from a local folder), this falls apart when starting the daemon from Upstart. I looked at my $PATH variable in an active environment, and copied it into the worker config:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">env</span> <span class="o">=</span> <span class="n">PATH</span><span class="o">=/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">venv</span><span class="o">/</span><span class="nb">bin</span><span class="p">:</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">sbin</span><span class="p">:</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="nb">bin</span><span class="p">:</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">sbin</span><span class="p">:</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="nb">bin</span><span class="p">:</span><span class="o">/</span><span class="n">sbin</span><span class="p">:</span><span class="o">/</span><span class="nb">bin</span><span class="p">,</span><span class="n">VIRTUAL_ENV</span><span class="o">=/</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">venv</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Circus Web Console behind Nginx with Sockets</h2>

<p>Circus has a sweet web console to manage processes and workers. By default, it runs on port 8080, and uses websockets to push stats on CPU, memory and socket reads for each running process. The web console should never be publicly available, it allows arbitrary commands to be executed on the server. The preferred way to password protect the console is to use Nginx like so:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">server</span> <span class="p">{</span>
</span><span class='line'>    <span class="n">listen</span>  <span class="mi">8001</span><span class="p">;</span>
</span><span class='line'>  <span class="n">location</span> <span class="o">~/</span><span class="n">media</span><span class="o">/*</span><span class="p">(</span><span class="o">.</span><span class="n">jpg</span><span class="o">|.</span><span class="n">css</span><span class="o">|.</span><span class="n">js</span><span class="p">)</span><span class="err">$</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">alias</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python2</span><span class="o">.</span><span class="mi">7</span><span class="o">/</span><span class="n">dist</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">circus</span><span class="o">/</span><span class="n">web</span><span class="o">/</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">location</span> <span class="o">/</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">proxy_set_header</span> <span class="n">X</span><span class="o">-</span><span class="n">Forwarded</span><span class="o">-</span><span class="n">For</span> <span class="err">$</span><span class="n">proxy_add_x_forwarded_for</span><span class="p">;</span>
</span><span class='line'>      <span class="n">proxy_set_header</span> <span class="n">Host</span> <span class="err">$</span><span class="n">http_host</span><span class="p">;</span>
</span><span class='line'>      <span class="n">proxy_redirect</span> <span class="n">off</span><span class="p">;</span>
</span><span class='line'>      <span class="n">proxy_pass</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span><span class="p">:</span><span class="mi">8080</span><span class="p">;</span>
</span><span class='line'>      <span class="n">auth_basic</span>            <span class="s">&quot;Restricted&quot;</span><span class="p">;</span>
</span><span class='line'>      <span class="n">auth_basic_user_file</span>  <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">nginx</span><span class="o">/</span><span class="n">htpasswd</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>I have the web console process listening on 8080: it&#8217;s serving both the website and the socket connection. Notice the issue? Nginx <a href="https://github.com/LearnBoost/socket.io/wiki/Nginx-and-socket.io">doesn&#8217;t support websockets</a>! So I&#8217;m running Nginx on port 8001, and the web console processs on 8080. And this is where Varnish comes in: Varnish is a caching proxy, but I&#8217;ll just use it to multiplex port 8002 to two seperate backends. If the connection is a websocket, route it directly to 8080. If it&#8217;s the website, switch the backend to Nginx on port 8001:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="n">backend</span> <span class="n">default</span> <span class="p">{</span>
</span><span class='line'>    <span class="o">.</span><span class="n">host</span> <span class="o">=</span> <span class="s">&quot;127.0.0.1&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="o">.</span><span class="n">port</span> <span class="o">=</span> <span class="s">&quot;8001&quot;</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">backend</span> <span class="n">socket</span> <span class="p">{</span>
</span><span class='line'>    <span class="o">.</span><span class="n">host</span> <span class="o">=</span> <span class="s">&quot;127.0.0.1&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="o">.</span><span class="n">port</span> <span class="o">=</span> <span class="s">&quot;8080&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="o">.</span><span class="n">connect_timeout</span> <span class="o">=</span> <span class="mi">1</span><span class="n">s</span><span class="p">;</span>
</span><span class='line'>    <span class="o">.</span><span class="n">first_byte_timeout</span> <span class="o">=</span> <span class="mi">2</span><span class="n">s</span><span class="p">;</span>
</span><span class='line'>    <span class="o">.</span><span class="n">between_bytes_timeout</span> <span class="o">=</span> <span class="mi">60</span><span class="n">s</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">sub</span> <span class="n">vcl_pipe</span> <span class="p">{</span>
</span><span class='line'>     <span class="k">if</span> <span class="p">(</span><span class="n">req</span><span class="o">.</span><span class="n">http</span><span class="o">.</span><span class="n">upgrade</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>         <span class="nb">set</span> <span class="n">bereq</span><span class="o">.</span><span class="n">http</span><span class="o">.</span><span class="n">upgrade</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="n">http</span><span class="o">.</span><span class="n">upgrade</span><span class="p">;</span>
</span><span class='line'>     <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">sub</span> <span class="n">vcl_recv</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">req</span><span class="o">.</span><span class="n">http</span><span class="o">.</span><span class="n">Upgrade</span> <span class="o">~</span> <span class="s">&quot;(?i)websocket&quot;</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nb">set</span> <span class="n">req</span><span class="o">.</span><span class="n">backend</span> <span class="o">=</span> <span class="n">socket</span><span class="p">;</span>
</span><span class='line'>      <span class="k">return</span> <span class="p">(</span><span class="n">pipe</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>




		
		
	</div>
</article>


    <article class="post">
	<div class="date">








  


<time datetime="2012-09-19T04:32:00-04:00" pubdate data-updated="true">Sep 19<span>th</span>, 2012</time></div>
	<h1 class="title"><a href="/fontprep-the-missing-css3-font-generator-for-mac-os-x/">FontPrep: The Missing CSS3 Font Generator for Mac OS X</a></h1>
	<div class="entry-content">
		<p><img class="right" src="http://nathancahill.github.com/images/window3.png"></p>

<p>A couple days ago, if you asked me how to add webfonts to my website, I would have immediately said <a href="http://www.fontsquirrel.com/">Font Squirrel</a>. One of the reasons that Font Squirrel is awesome is their <a href="http://www.fontsquirrel.com/fontface/generator">@font-face generator</a>. It is the most popular solution for generating webfonts and font CSS online.</p>

<p>That&#8217;s all about to change. See, there are several limitations to using an online generator for fonts. After uploading two or three fonts, it&#8217;s obvious that Font Squirrel would be not be able to handle hundreds of font files. A web browser simply isn&#8217;t built to support that. Previewing generated fonts in the browser on the fly is also impossible. There&#8217;s also the licensing to worry about: Font Squirrel only accepts fonts that are &#8220;legally eligible for web embedding.&#8221;</p>

<p><a href="http://fontprep.com/">FontPrep</a> solves all of this. FontPrep is a native Mac OS X app that prepares your fonts for the web. At its core, it generates webfont bundles with full browser compatibility. After dragging and dropping a TTF font on to the app, the whole bundle can be downloaded, including WOFF, SVG and EOT formats, and the snippets of CSS needed to add these fonts to a website. And that&#8217;s just scraping the surface of what the app can do:</p>

<p>FontPrep can spin up a local server running a font testbed in the browser. After adding fonts to FontPrep, the entire webfont can be previewed in the browser. Every glyph in the typeface is rendered, as well as a waterfall of font sizes and a text area for testing the font with custom text. Font size is easily changed as well.</p>

<p>According to the creators, <a href="https://twitter.com/briangonzalez__">Brian</a> and <a href="https://twitter.com/artisfacto">Matthew Gonzalez</a>, FontPrep was created with the goal of making an &#8220;easy to use, drag &amp; drop OSX app which makes our lives as developers much easier when it comes to working with fonts.&#8221; They succeeded: not only is FontPrep highly functional, it is also beautiful. Admittedly, their app have less options than Expert mode on Font Squirrel, but they are working on adding more support. Meanwhile, head over to <a href="http://fontprep.com/">FontPrep.com</a> and pick up the app. It&#8217;s free for the next 6 hours, after that it costs $5.</p>

		
		
	</div>
</article>


    <article class="post">
	<div class="date">








  


<time datetime="2012-09-19T01:35:00-04:00" pubdate data-updated="true">Sep 19<span>th</span>, 2012</time></div>
	<h1 class="title"><a href="/iterm-plus-bettertouchtool/">iTerm + BetterTouchTool</a></h1>
	<div class="entry-content">
		<p>The best terminal emulator for Mac OS X is <a href="http://www.iterm2.com/">iTerm2</a>. I especially love the drop-down style windows.
No matter what I&#8217;m doing, there&#8217;s always a command prompt a &#x2318;+Tab away. And it floats over my current windows, so I
can read commands from <a href="http://stackoverflow.com/">Stackoverflow</a> while I&#8217;m typing #noob.</p>

<p>This is the year 2012 though, and while we don&#8217;t have <a href="http://fuckjetpacks.com/read/why">jet packs</a> yet, we should at least be able to
flick things around a screen with a swipe of our fingers. Enter <a href="http://www.boastr.de/">BetterTouchTool</a>. This is basically an awesome
app that lets you define a bunch of custom gestures for your trackpad and Magic Mouse. <a href="http://qsapp.com/">Quicksilver</a> for gestures, if you will.</p>

<p>The magic glue for all of this is the key-binding option in iTerm. Go to iTerm Preferences > Profiles > Hotkey Window. You can choose
a shortcut key, in my case &#x2303;&#x2318;O, to trigger the app. Since it&#8217;s a system-wide hotkey, choose something that doesn&#8217;t conflict with apps you use.
&#x2303;&#x2318;Z is a really bad choice if you use Photoshop ;)</p>

<p><img src="http://nathancahill.github.com/images/window.png"></p>

<p>Once you have the HotKey set up in iTerm, set up a Global gesture in BetterTouchTool. I&#8217;m a fan of the three-finger swipe down, it feels natural and doesn&#8217;t
conflict with Spaces for me, since I&#8217;m still rocking Snow Leopard. Obviously hook it up to the same shortcut key you used in iTerm. Now,
you should be able to swipe to get a command prompt.</p>

<p>But how about sending it back up? It feels natural to swipe back up, but there&#8217;s no way to trigger that in iTerm. So, fellow hacker,
add a second gesture, the three-finger swipe up, and bind it to &#x2318;+Tab. This simply switches back to the original app
you were using before you triggered iTerm, and effectively sends the window swishing back up.</p>

<p><img src="http://nathancahill.github.com/images/window2.png"></p>

		
		
	</div>
</article>


    <article class="post">
	<div class="date">








  


<time datetime="2012-09-09T02:59:00-04:00" pubdate data-updated="true">Sep 9<span>th</span>, 2012</time></div>
	<h1 class="title"><a href="/make-requests-cache-play-nicely-with-heroku/">Make Requests-Cache Play Nicely With Heroku</a></h1>
	<div class="entry-content">
		<p>The Python module that has saved me the most time is, without a doubt, the
<a href="http://docs.python-requests.org/en/latest/index.html">Requests</a> module by
<a href="http://kennethreitz.com/">Kenneth Reitz</a>. This guy never fails to produces awesomeness.</p>

<p>The tagline is &#8220;HTTP for Humans&#8221;, and the whole thing is very pythonic. It was missing,
however, an equally pythonic way to deal with caching. Fortunately,
<a href="https://github.com/reclosedev/requests-cache">Requests-Cache</a> fills the void. It supports
several different caching backends, as well as an extensible interface for adding new
ones.</p>

<p>SQLite is the default, and probably works well in most cases. But it fails completely when
deploying to Heroku. That&#8217;s because SQLite requires a permanent writable file system. It
ultimately needs access to the POSIX fopen() and fwrite() API calls to a particular file.
<a href="https://devcenter.heroku.com/articles/dynos#ephemeral-filesystem">Heroku does not provide a permanent writable file system</a>.
It doesn&#8217;t even allow the SQLite3 module to be installed:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ImportError: No module named _sqlite3</span></code></pre></td></tr></table></div></figure>


<p>Even though Requests-Cache supports in memory caching, I had to remove a couple parts of
the module to get it to even import on Heroku. I removed the sqlite.py backend file <code>requests_cache/backends/sqlite.py</code>
and delete the couple sqlite lines from <code>requests_cache/backends/__init__.py</code>. After
that, it imported fine and is easy to set up in memory caches, like this:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>requests_cache.configure('cache_name', 'memory')</span></code></pre></td></tr></table></div></figure>


<p>Here&#8217;s <a href="https://github.com/nathancahill/requests-cache">my fork of the repo</a> with those changes.</p>

<p>If you know a better solution, or have another way of caching HTTP requests easily with
Python, let me know.</p>

		
		
	</div>
</article>


    <article class="post">
	<div class="date">








  


<time datetime="2012-09-07T20:04:00-04:00" pubdate data-updated="true">Sep 7<span>th</span>, 2012</time></div>
	<h1 class="title"><a href="/oauth-with-twitter-and-python-flask/">OAuth With Twitter and Python Flask</a></h1>
	<div class="entry-content">
		<p>Here&#8217;s a couple tips on getting OAuth to work with Python Flask.</p>

<p>First, Flask has bunch of <a href="http://flask.pocoo.org/extensions/">awesome extensions</a> that
make coding with Flask so easy. The two I am using for an OAuth login system are
<a href="http://packages.python.org/Flask-OAuth/">Flask-OAuth</a> (obviously), and
<a href="http://packages.python.org/Flask-Login/">Flask-Login</a>. The database I am using is
Postgres, with the great <a href="http://packages.python.org/Flask-SQLAlchemy/">Flask-SQLAlchemy</a>
ORM.</p>

<p>The User class I am using just needs 3 properties:</p>

<ul>
<li><code>username</code></li>
<li><code>token</code></li>
<li><code>secret</code></li>
</ul>


<p>For Flask-OAuth, most of the default configuration works as described. However, I did have
to change the <code>request_token_url</code>, <code>access_token_url</code> and <code>authorize_url</code>
to use https. The <code>access_token_url</code> should point to
&#8220;https://api.twitter.com/oauth/authenticate&#8221; for processing the login.</p>

<p>I had trouble getting it to recognize the callback URL. I kept getting this error: <code>raise OAuthException('Failed to generate request token')</code>. I gave up debugging it,
and just added the correct callback URL in the settings in Twitter.</p>

<p>Using Flask-Login is also straight forward. I initially didn&#8217;t know how to make enable a
User class to use the login system, turns out it&#8217;s just a four functions that have to be
included in the class:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">def</span> <span class="nf">get_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>  <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">is_authenticated</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>  <span class="k">return</span> <span class="bp">True</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">is_active</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>  <span class="k">return</span> <span class="bp">True</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">is_anonymous</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>  <span class="k">return</span> <span class="bp">False</span>
</span></code></pre></td></tr></table></div></figure>


<p>The glue that makes the two play nicely together is all in these three functions:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="nd">@app.route</span><span class="p">(</span><span class="s">&#39;/login&#39;</span><span class="p">)</span>
</span><span class='line'><span class="k">def</span> <span class="nf">login</span><span class="p">():</span>
</span><span class='line'>  <span class="k">if</span> <span class="n">current_user</span><span class="o">.</span><span class="n">is_authenticated</span><span class="p">():</span>
</span><span class='line'>      <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">twitter</span><span class="o">.</span><span class="n">authorize</span><span class="p">(</span><span class="n">callback</span><span class="o">=</span><span class="n">url_for</span><span class="p">(</span><span class="s">&#39;oauth_authorized&#39;</span><span class="p">,</span>
</span><span class='line'>      <span class="nb">next</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;next&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">request</span><span class="o">.</span><span class="n">referrer</span> <span class="ow">or</span> <span class="bp">None</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<p>Before I send a Twitter OAuth request, I make sure the current_user is not authenticated.
If I didn&#8217;t the OAuth would fail. Not sure why yet.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="nd">@app.route</span><span class="p">(</span><span class="s">&#39;/oauth-authorized&#39;</span><span class="p">)</span>
</span><span class='line'><span class="nd">@twitter.authorized_handler</span>
</span><span class='line'><span class="k">def</span> <span class="nf">oauth_authorized</span><span class="p">(</span><span class="n">resp</span><span class="p">):</span>
</span><span class='line'>  <span class="n">next_url</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;next&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">url_for</span><span class="p">(</span><span class="s">&#39;index&#39;</span><span class="p">)</span>
</span><span class='line'>  <span class="k">if</span> <span class="n">resp</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
</span><span class='line'>      <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">next_url</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">this_account</span> <span class="o">=</span> <span class="n">Account</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">username</span> <span class="o">=</span> <span class="n">resp</span><span class="p">[</span><span class="s">&#39;screen_name&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
</span><span class='line'>  <span class="k">if</span> <span class="n">this_account</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
</span><span class='line'>      <span class="n">new_account</span> <span class="o">=</span> <span class="n">Account</span><span class="p">(</span><span class="n">resp</span><span class="p">[</span><span class="s">&#39;screen_name&#39;</span><span class="p">],</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">resp</span><span class="p">[</span><span class="s">&#39;oauth_token&#39;</span><span class="p">],</span> <span class="n">resp</span><span class="p">[</span><span class="s">&#39;oauth_token_secret&#39;</span><span class="p">])</span>
</span><span class='line'>      <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">new_account</span><span class="p">)</span>
</span><span class='line'>      <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</span><span class='line'>      <span class="n">login_user</span><span class="p">(</span><span class="n">new_account</span><span class="p">)</span>
</span><span class='line'>  <span class="k">else</span><span class="p">:</span>
</span><span class='line'>      <span class="n">login_user</span><span class="p">(</span><span class="n">this_account</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">next_url</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>What the callback handler does:</p>

<p>Once the authentication is complete, it looks in the database for the Twitter username. If
it&#8217;s not found, it creates a new account and calls <code>login_user()</code>. If it is, it uses
the returned account object to login the user.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="nd">@twitter.tokengetter</span>
</span><span class='line'><span class="k">def</span> <span class="nf">get_twitter_token</span><span class="p">():</span>
</span><span class='line'>  <span class="k">if</span> <span class="n">current_user</span><span class="o">.</span><span class="n">is_authenticated</span><span class="p">():</span>
</span><span class='line'>      <span class="k">return</span> <span class="p">(</span><span class="n">current_user</span><span class="o">.</span><span class="n">token</span><span class="p">,</span> <span class="n">current_user</span><span class="o">.</span><span class="n">secret</span><span class="p">)</span>
</span><span class='line'>  <span class="k">else</span><span class="p">:</span>
</span><span class='line'>      <span class="k">return</span> <span class="bp">None</span>
</span></code></pre></td></tr></table></div></figure>


<p>This third function is self-explanatory.</p>

<p>Now, it&#8217;s as easy adding the <code>@login_required</code> decorator before a secure page
function.</p>

		
		
	</div>
</article>

<nav id="pagenavi">
    
    
        <a href="/blog/page/2/" class="next">Next</a>
    
    <div class="center"><a href="/blog/archives">Blog Archives</a></div>
</nav></div>
	<footer id="footer" class="inner">Copyright &copy; 2012

    Nathan Cahill

</footer>
	<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->


<script type="text/javascript">
      var disqus_shortname = 'nathancahill';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-29405367-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>



</body>
</html>