
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>Nathan Cahill</title>
	<meta name="author" content="Nathan Cahill">

	
	<meta name="description" content="The best terminal emulator for Mac OS X is iTerm2. I especially love the drop-down style windows.
No matter what I&#8217;m doing, there&#8217;s &hellip;">
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="Nathan Cahill" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<script type="text/javascript" src="//use.typekit.net/dqs7xdv.js"></script>
<script type="text/javascript">try{Typekit.load();}catch(e){}</script>
</head>

<body>
	<header id="header" class="inner"><h1><a href="/">Nathan Cahill</a></h1>
<nav id="main-nav"><ul class="main">
	<li><a href="/blog/archives">Archives</a></li>
	<li><a href="http://www.nathancahill.com">Website + Portfolio</a></li>
	<li><a href="https://github.com/nathancahill">Github</a></li>
	<li><a href="https://twitter.com/nathancahill">Twitter</a></li>
</ul>
</nav>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul class="main">
	<li><a href="/blog/archives">Archives</a></li>
	<li><a href="http://www.nathancahill.com">Website + Portfolio</a></li>
	<li><a href="https://github.com/nathancahill">Github</a></li>
	<li><a href="https://twitter.com/nathancahill">Twitter</a></li>
</ul>
</div>
	</div>
	<div class="alignright search">
		<a class="button"></a>
		<div class="container">
			<form action="http://google.com/search" method="get">
				<input type="text" name="q" results="0">
				<input type="hidden" name="q" value="site:nathancahill.github.com">
			</form>
		</div>
	</div>
</nav>
<nav id="sub-nav" class="alignright">
	<div class="social">
		
		
		
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
	</div>
	<form class="search" action="http://google.com/search" method="get">
		<input class="alignright" type="text" name="q" results="0">
		<input type="hidden" name="q" value="site:nathancahill.github.com">
	</form>
</nav>

</header>
	
		
	
	<div id="content" class="inner">


    <article class="post">
	<div class="date">








  


<time datetime="2012-09-19T01:35:00-07:00" pubdate data-updated="true">Sep 19<span>th</span>, 2012</time></div>
	<h1 class="title"><a href="/iterm-plus-bettertouchtool/">iTerm + BetterTouchTool</a></h1>
	<div class="entry-content">
		<p>The best terminal emulator for Mac OS X is <a href="http://www.iterm2.com/">iTerm2</a>. I especially love the drop-down style windows.
No matter what I&#8217;m doing, there&#8217;s always a command prompt a &#x2318;+Tab away. And it floats over my current windows, so I
can read commands from <a href="http://stackoverflow.com/">Stackoverflow</a> while I&#8217;m typing #noob.</p>

<p>This is the year 2012 though, and while we don&#8217;t have <a href="http://fuckjetpacks.com/read/why">jet packs</a> yet, we should at least be able to
flick things around a screen with a swipe of our fingers. Enter <a href="http://www.boastr.de/">BetterTouchTool</a>. This is basically an awesome
app that lets you define a bunch of custom gestures for your trackpad and Magic Mouse. <a href="http://qsapp.com/">Quicksilver</a> for gestures, if you will.</p>

<p>The magic glue for all of this is the key-binding option in iTerm. Go to iTerm Preferences > Profiles > Hotkey Window. You can choose
a shortcut key, in my case &#x2303;&#x2318;O, to trigger the app. Since it&#8217;s a system-wide hotkey, choose something that doesn&#8217;t conflict with apps you use.
&#x2303;&#x2318;Z is a really bad choice if you use Photoshop ;)</p>

<p><img src="http://nathancahill.github.com/images/window.png"></p>

<p>Once you have the HotKey set up in iTerm, set up a Global gesture in BetterTouchTool. I&#8217;m a fan of the three-finger swipe down, it feels natural and doesn&#8217;t
conflict with Spaces for me, since I&#8217;m still rocking Snow Leopard. Obviously hook it up to the same shortcut key you used in iTerm. Now,
you should be able to swipe to get a command prompt.</p>

<p>But how about sending it back up? It feels natural to swipe back up, but there&#8217;s no way to trigger that in iTerm. So, fellow hacker,
add a second gesture, the three-finger swipe up, and bind it to &#x2318;+Tab. This simply switches back to the original app
you were using before you triggered iTerm, and effectively sends the window swishing back up.</p>

<p><img src="http://nathancahill.github.com/images/window2.png"></p>

		
		
	</div>
</article>


    <article class="post">
	<div class="date">








  


<time datetime="2012-09-09T02:59:00-07:00" pubdate data-updated="true">Sep 9<span>th</span>, 2012</time></div>
	<h1 class="title"><a href="/make-requests-cache-play-nicely-with-heroku/">Make Requests-Cache Play Nicely With Heroku</a></h1>
	<div class="entry-content">
		<p>The Python module that has saved me the most time is, without a doubt, the
<a href="http://docs.python-requests.org/en/latest/index.html">Requests</a> module by
<a href="http://kennethreitz.com/">Kenneth Reitz</a>. This guy never fails to produces awesomeness.</p>

<p>The tagline is &#8220;HTTP for Humans&#8221;, and the whole thing is very pythonic. It was missing,
however, an equally pythonic way to deal with caching. Fortunately,
<a href="https://github.com/reclosedev/requests-cache">Requests-Cache</a> fills the void. It supports
several different caching backends, as well as an extensible interface for adding new
ones.</p>

<p>SQLite is the default, and probably works well in most cases. But it fails completely when
deploying to Heroku. That&#8217;s because SQLite requires a permanent writable file system. It
ultimately needs access to the POSIX fopen() and fwrite() API calls to a particular file.
<a href="https://devcenter.heroku.com/articles/dynos#ephemeral-filesystem">Heroku does not provide a permanent writable file system</a>.
It doesn&#8217;t even allow the SQLite3 module to be installed:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ImportError: No module named _sqlite3</span></code></pre></td></tr></table></div></figure>


<p>Even though Requests-Cache supports in memory caching, I had to remove a couple parts of
the module to get it to even import on Heroku. I removed the sqlite.py backend file <code>requests_cache/backends/sqlite.py</code>
and delete the couple sqlite lines from <code>requests_cache/backends/__init__.py</code>. After
that, it imported fine and is easy to set up in memory caches, like this:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>requests_cache.configure('cache_name', 'memory')</span></code></pre></td></tr></table></div></figure>


<p>Here&#8217;s <a href="https://github.com/nathancahill/requests-cache">my fork of the repo</a> with those changes.</p>

<p>If you know a better solution, or have another way of caching HTTP requests easily with
Python, let me know.</p>

		
		
	</div>
</article>


    <article class="post">
	<div class="date">








  


<time datetime="2012-09-07T20:04:00-07:00" pubdate data-updated="true">Sep 7<span>th</span>, 2012</time></div>
	<h1 class="title"><a href="/oauth-with-twitter-and-python-flask/">OAuth With Twitter and Python Flask</a></h1>
	<div class="entry-content">
		<p>Here&#8217;s a couple tips on getting OAuth to work with Python Flask.</p>

<p>First, Flask has bunch of <a href="http://flask.pocoo.org/extensions/">awesome extensions</a> that
make coding with Flask so easy. The two I am using for an OAuth login system are
<a href="http://packages.python.org/Flask-OAuth/">Flask-OAuth</a> (obviously), and
<a href="http://packages.python.org/Flask-Login/">Flask-Login</a>. The database I am using is
Postgres, with the great <a href="http://packages.python.org/Flask-SQLAlchemy/">Flask-SQLAlchemy</a>
ORM.</p>

<p>The User class I am using just needs 3 properties:</p>

<ul>
<li><code>username</code></li>
<li><code>token</code></li>
<li><code>secret</code></li>
</ul>


<p>For Flask-OAuth, most of the default configuration works as described. However, I did have
to change the <code>request_token_url</code>, <code>access_token_url</code> and <code>authorize_url</code>
to use https. The <code>access_token_url</code> should point to
&#8220;https://api.twitter.com/oauth/authenticate&#8221; for processing the login.</p>

<p>I had trouble getting it to recognize the callback URL. I kept getting this error: <code>raise OAuthException('Failed to generate request token')</code>. I gave up debugging it,
and just added the correct callback URL in the settings in Twitter.</p>

<p>Using Flask-Login is also straight forward. I initially didn&#8217;t know how to make enable a
User class to use the login system, turns out it&#8217;s just a four functions that have to be
included in the class:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">def</span> <span class="nf">get_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>  <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">is_authenticated</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>  <span class="k">return</span> <span class="bp">True</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">is_active</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>  <span class="k">return</span> <span class="bp">True</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">is_anonymous</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>  <span class="k">return</span> <span class="bp">False</span>
</span></code></pre></td></tr></table></div></figure>


<p>The glue that makes the two play nicely together is all in these three functions:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="nd">@app.route</span><span class="p">(</span><span class="s">&#39;/login&#39;</span><span class="p">)</span>
</span><span class='line'><span class="k">def</span> <span class="nf">login</span><span class="p">():</span>
</span><span class='line'>  <span class="k">if</span> <span class="n">current_user</span><span class="o">.</span><span class="n">is_authenticated</span><span class="p">():</span>
</span><span class='line'>      <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">twitter</span><span class="o">.</span><span class="n">authorize</span><span class="p">(</span><span class="n">callback</span><span class="o">=</span><span class="n">url_for</span><span class="p">(</span><span class="s">&#39;oauth_authorized&#39;</span><span class="p">,</span>
</span><span class='line'>      <span class="nb">next</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;next&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">request</span><span class="o">.</span><span class="n">referrer</span> <span class="ow">or</span> <span class="bp">None</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<p>Before I send a Twitter OAuth request, I make sure the current_user is not authenticated.
If I didn&#8217;t the OAuth would fail. Not sure why yet.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="nd">@app.route</span><span class="p">(</span><span class="s">&#39;/oauth-authorized&#39;</span><span class="p">)</span>
</span><span class='line'><span class="nd">@twitter.authorized_handler</span>
</span><span class='line'><span class="k">def</span> <span class="nf">oauth_authorized</span><span class="p">(</span><span class="n">resp</span><span class="p">):</span>
</span><span class='line'>  <span class="n">next_url</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;next&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">url_for</span><span class="p">(</span><span class="s">&#39;index&#39;</span><span class="p">)</span>
</span><span class='line'>  <span class="k">if</span> <span class="n">resp</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
</span><span class='line'>      <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">next_url</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">this_account</span> <span class="o">=</span> <span class="n">Account</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">username</span> <span class="o">=</span> <span class="n">resp</span><span class="p">[</span><span class="s">&#39;screen_name&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
</span><span class='line'>  <span class="k">if</span> <span class="n">this_account</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
</span><span class='line'>      <span class="n">new_account</span> <span class="o">=</span> <span class="n">Account</span><span class="p">(</span><span class="n">resp</span><span class="p">[</span><span class="s">&#39;screen_name&#39;</span><span class="p">],</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">resp</span><span class="p">[</span><span class="s">&#39;oauth_token&#39;</span><span class="p">],</span> <span class="n">resp</span><span class="p">[</span><span class="s">&#39;oauth_token_secret&#39;</span><span class="p">])</span>
</span><span class='line'>      <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">new_account</span><span class="p">)</span>
</span><span class='line'>      <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</span><span class='line'>      <span class="n">login_user</span><span class="p">(</span><span class="n">new_account</span><span class="p">)</span>
</span><span class='line'>  <span class="k">else</span><span class="p">:</span>
</span><span class='line'>      <span class="n">login_user</span><span class="p">(</span><span class="n">this_account</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">next_url</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>What the callback handler does:</p>

<p>Once the authentication is complete, it looks in the database for the Twitter username. If
it&#8217;s not found, it creates a new account and calls <code>login_user()</code>. If it is, it uses
the returned account object to login the user.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="nd">@twitter.tokengetter</span>
</span><span class='line'><span class="k">def</span> <span class="nf">get_twitter_token</span><span class="p">():</span>
</span><span class='line'>  <span class="k">if</span> <span class="n">current_user</span><span class="o">.</span><span class="n">is_authenticated</span><span class="p">():</span>
</span><span class='line'>      <span class="k">return</span> <span class="p">(</span><span class="n">current_user</span><span class="o">.</span><span class="n">token</span><span class="p">,</span> <span class="n">current_user</span><span class="o">.</span><span class="n">secret</span><span class="p">)</span>
</span><span class='line'>  <span class="k">else</span><span class="p">:</span>
</span><span class='line'>      <span class="k">return</span> <span class="bp">None</span>
</span></code></pre></td></tr></table></div></figure>


<p>This third function is self-explanatory.</p>

<p>Now, it&#8217;s as easy adding the <code>@login_required</code> decorator before a secure page
function.</p>

		
		
	</div>
</article>


    <article class="post">
	<div class="date">








  


<time datetime="2012-08-28T20:20:00-07:00" pubdate data-updated="true">Aug 28<span>th</span>, 2012</time></div>
	<h1 class="title"><a href="/film-canon-ae-1-program/">Film: Canon AE-1 Program</a></h1>
	<div class="entry-content">
		<p><img src="http://nathancahill.github.com/images/ae-1/8.jpg"></p>

<div class="gallery">
    <a class="fancybox" href="http://nathancahill.github.com/images/ae-1/2.jpg" title="Film: Canon AE-1 Program" rel="gallery2">
        <img src="http://nathancahill.github.com/images/ae-1/2_m.jpg">
    </a>
    <a class="fancybox" href="http://nathancahill.github.com/images/ae-1/4.jpg" title="Film: Canon AE-1 Program" rel="gallery2">
        <img src="http://nathancahill.github.com/images/ae-1/4_m.jpg">
    </a>
    <a class="fancybox" href="http://nathancahill.github.com/images/ae-1/5.jpg" title="Film: Canon AE-1 Program" rel="gallery2">
        <img src="http://nathancahill.github.com/images/ae-1/5_m.jpg">
    </a>
    <a class="fancybox" href="http://nathancahill.github.com/images/ae-1/7.jpg" title="Film: Canon AE-1 Program" rel="gallery2">
        <img src="http://nathancahill.github.com/images/ae-1/7_m.jpg">
    </a>
    <a class="fancybox" href="http://nathancahill.github.com/images/ae-1/1.jpg" title="Film: Canon AE-1 Program" rel="gallery2">
        <img src="http://nathancahill.github.com/images/ae-1/1_m.jpg">
    </a>
    <a class="fancybox" href="http://nathancahill.github.com/images/ae-1/9.jpg" title="Film: Canon AE-1 Program" rel="gallery2">
        <img src="http://nathancahill.github.com/images/ae-1/9_m.jpg">
    </a>
    <a class="fancybox" href="http://nathancahill.github.com/images/ae-1/10.jpg" title="Film: Canon AE-1 Program" rel="gallery2">
        <img src="http://nathancahill.github.com/images/ae-1/10_m.jpg">
    </a>
    <a class="fancybox" href="http://nathancahill.github.com/images/ae-1/11.jpg" title="Film: Canon AE-1 Program" rel="gallery2">
        <img src="http://nathancahill.github.com/images/ae-1/11_m.jpg">
    </a>
    <a class="fancybox" href="http://nathancahill.github.com/images/ae-1/12.jpg" title="Film: Canon AE-1 Program" rel="gallery2">
        <img src="http://nathancahill.github.com/images/ae-1/12_m.jpg">
    </a>
    <a class="fancybox" href="http://nathancahill.github.com/images/ae-1/13.jpg" title="Film: Canon AE-1 Program" rel="gallery2">
        <img src="http://nathancahill.github.com/images/ae-1/13_m.jpg">
    </a>
    <a class="fancybox" href="http://nathancahill.github.com/images/ae-1/14.jpg" title="Film: Canon AE-1 Program" rel="gallery2">
        <img src="http://nathancahill.github.com/images/ae-1/14_m.jpg">
    </a>
    <a class="fancybox" href="http://nathancahill.github.com/images/ae-1/15.jpg" title="Film: Canon AE-1 Program" rel="gallery2">
        <img src="http://nathancahill.github.com/images/ae-1/15_m.jpg">
    </a>
    <a class="fancybox" href="http://nathancahill.github.com/images/ae-1/21.jpg" title="Film: Canon AE-1 Program" rel="gallery2">
        <img src="http://nathancahill.github.com/images/ae-1/21_m.jpg">
    </a>
    <div class="clear"></div>
</div>


		
		
	</div>
</article>


    <article class="post">
	<div class="date">








  


<time datetime="2012-08-16T00:41:00-07:00" pubdate data-updated="true">Aug 16<span>th</span>, 2012</time></div>
	<h1 class="title"><a href="/startup-in-dot-dot-dot-latin-america/">Startup in&#8230; Latin America?</a></h1>
	<div class="entry-content">
		<p>Paul Graham recently wrote about <a href="http://www.paulgraham.com/hubs.html">Why Startup Hubs Work</a>. He cited two reasons why startups do not die in startup hubs:</p>

<blockquote><p>&#8220;[1] being in a place where startups are the cool thing to do, and [2] chance meetings with people who can help you. And what drives them both is the number of startup people around you.&#8221;</p></blockquote>

<p>Starting a startup is hard enough, doing so in a place where it is seen as synonymous with unemployment is a major setback. And chance meetings with mentors and people pursuing the same ideas can be miraculous for a startup. While I believe these antidotes for &#8220;startup death&#8221; are true in developed countries like the US, developing countries like Guatemala bring new factors into play.</p>

<p><img class="right" src="http://www.comscoredatamine.com/wp-content/uploads/2011/06/avg-hours-on-sn-sites-apr-11-ww.jpg" title="'Average Time Spent on Social Networking Sites Across Geographies'" ></p>

<p>In the United States, the number of entrepreneurs has hovered around 10%, give or take, depending on the economy. In Latin America, on the other hand, this number <a href="http://www.internationalentrepreneurship.com/americas/">averages around 20%</a>, with the highest around 30-35% in Peru and Bolivia. Starting a startup is not looked down upon as unemployment, indeed, these people are thought highly of in the community.</p>

<p>Other quirks of a developing country that a startup can benefit from are the limited availability of good wages and the cheap abundance of resources. More people are likely to start their own business when they can get better wages working for themselves. Work-live places, an essential for startup entrepreneurs are easier than ever to create when the cost of living is <a href="http://www.numbeo.com/cost-of-living/country_result.jsp?country=Guatemala">a fifth of the cost in the US</a>. Latin American countries also tend to rapidly adopt new technologies: most people in Guatemala leapfrogged from no phone connection within miles to 3G cellphones in a couple of years. Argentina, Venezuela, Colombia, Chile, Mexico, Puerto Rico and Peru are 7 of the <a href="http://www.comscoredatamine.com/2011/06/average-time-spent-on-social-networking-sites-across-geographies/">top 20 countries using social networks</a>:</p>

<p>Lacking a strong community of mentors that startup hubs like Silicon Valley, Boston or Boulder offer is one of the biggest setbacks. But as the connectivity and education increases there is no question this will change. Guatemalan businesses are starting to prop up .com.gt websites in a similar way as the beginning of the .com bubble years ago. Given the rate of conversion to new technologies, the creativity and self-discipline people have to new startups and the economy of resourcefulness, Latin America will soon produce startups to rival Silicon Valley.</p>

		
		
	</div>
</article>


    <article class="post">
	<div class="date">








  


<time datetime="2012-06-16T08:15:00-07:00" pubdate data-updated="true">Jun 16<span>th</span>, 2012</time></div>
	<h1 class="title"><a href="/on-extracting-an-element-from-a-web-page-with-css-styles/">On Extracting an Element From a Web Page With CSS Styles</a></h1>
	<div class="entry-content">
		<p>The goal: to extract an element from a web page and display it independently from it&#8217;s original website.</p>

<p>Note: I initially toyed with running this whole process server-side, and it still may be the more efficient way to to this. This is extraordinarily difficult though, you will soon see why.</p>

<p>First, we fetch the complete web page from our target site. For example, news.google.com. We then dump the web page into an invisible div.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="cp">&lt;?php</span>
</span><span class='line'><span class="nv">$ch</span> <span class="o">=</span> <span class="nb">curl_init</span><span class="p">();</span>
</span><span class='line'><span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$ch</span><span class="p">,</span> <span class="nx">CURLOPT_URL</span><span class="p">,</span> <span class="s1">&#39;http://news.google.com/&#39;</span><span class="p">);</span>
</span><span class='line'><span class="nv">$html</span> <span class="o">=</span> <span class="nb">curl_exec</span><span class="p">(</span><span class="nv">$ch</span><span class="p">);</span>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span><span class='line'>
</span><span class='line'><span class="x">&lt;div style=&quot;display:none;&quot;&gt;</span>
</span><span class='line'><span class="x">    </span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$html</span><span class="p">;</span> <span class="cp">?&gt;</span><span class="x"></span>
</span><span class='line'><span class="x">&lt;/div&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Our target element is the Recent News box on the right of the page. The id is &#8216;s_BREAKING_NEWS_BOX&#8217;. Extracting the HTML is easy enough with jQuery:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;&lt;div&gt;&#39;</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#s_BREAKING_NEWS_BOX&#39;</span><span class="p">).</span><span class="nx">clone</span><span class="p">()).</span><span class="nx">remove</span><span class="p">().</span><span class="nx">html</span><span class="p">();</span>
</span></code></pre></td></tr></table></div></figure>


<p>If we were to just output the HTML at this point, we would get text with default browser styles. We need to copy the computed CSS styles from the original rendering to our new element. Firefox, Chrome and Safari use getComputedStyle, IE uses currentStyle.</p>

<p>Here&#8217;s our JavaScript function to do just that:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">function</span> <span class="nx">getPropValue</span><span class="p">(</span><span class="nx">ele</span><span class="p">,</span> <span class="nx">styleProp</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="nx">ele</span><span class="p">.</span><span class="nx">currentStyle</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="kd">var</span> <span class="nx">y</span> <span class="o">=</span> <span class="nx">ele</span><span class="p">.</span><span class="nx">currentStyle</span><span class="p">[</span><span class="nx">styleProp</span><span class="p">];</span>
</span><span class='line'>    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">getComputedStyle</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="kd">var</span> <span class="nx">y</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">defaultView</span><span class="p">.</span><span class="nx">getComputedStyle</span><span class="p">(</span><span class="nx">ele</span><span class="p">,</span> <span class="kc">null</span><span class="p">).</span><span class="nx">getPropertyValue</span><span class="p">(</span><span class="nx">styleProp</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">return</span> <span class="nx">y</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>This function requires an element, and the CSS property that we want to grab. So we can define an array of properties we want to copy, then loop through these properties to get the entire style for the element.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">styles</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">,</span> <span class="s2">&quot;font-family&quot;</span><span class="p">,</span> <span class="s2">&quot;font-size&quot;</span><span class="p">,</span> <span class="s2">&quot;line-height&quot;</span><span class="p">,</span> <span class="s2">&quot;white-space&quot;</span><span class="p">,</span> <span class="s2">&quot;padding&quot;</span><span class="p">,</span> <span class="s2">&quot;display&quot;</span><span class="p">,</span> <span class="s2">&quot;float&quot;</span><span class="p">,</span> <span class="s2">&quot;border&quot;</span><span class="p">,</span> <span class="s2">&quot;border-top&quot;</span><span class="p">,</span> <span class="s2">&quot;border-right&quot;</span><span class="p">,</span> <span class="s2">&quot;border-bottom&quot;</span><span class="p">,</span> <span class="s2">&quot;border-left&quot;</span><span class="p">,</span> <span class="s2">&quot;border-color&quot;</span><span class="p">,</span> <span class="s2">&quot;border-width&quot;</span><span class="p">,</span> <span class="s2">&quot;border-style&quot;</span><span class="p">,</span> <span class="s2">&quot;padding-top&quot;</span><span class="p">,</span> <span class="s2">&quot;padding-right&quot;</span><span class="p">,</span> <span class="s2">&quot;padding-bottom&quot;</span><span class="p">,</span> <span class="s2">&quot;padding-left&quot;</span><span class="p">,</span> <span class="s2">&quot;height&quot;</span><span class="p">,</span> <span class="s2">&quot;font-weight&quot;</span><span class="p">,</span> <span class="s2">&quot;margin-top&quot;</span><span class="p">,</span> <span class="s2">&quot;margin-left&quot;</span><span class="p">,</span> <span class="s2">&quot;margin-bottom&quot;</span><span class="p">,</span> <span class="s2">&quot;margin-right&quot;</span><span class="p">,</span> <span class="s2">&quot;text-decoration&quot;</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'><span class="kd">function</span> <span class="nx">getStyles</span><span class="p">(</span><span class="nx">ele</span><span class="p">,</span> <span class="nx">styles</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="kd">var</span> <span class="nx">values</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Array</span><span class="p">();</span>
</span><span class='line'>    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">styles</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">values</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">getPropValue</span><span class="p">(</span><span class="nx">ele</span><span class="p">,</span> <span class="nx">styles</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">return</span> <span class="nx">values</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>If we give getStyles an element reference and an array of styles, we get an array of computed CSS values for that element. But remember, we need to do this for every single child element, not just the parent s_BREAKING_NEWS_BOX element. So we need a recursive loop that runs getStyles on the parent, the children, grandchildren, etc. We also have a running count, index, to keep give each elements styles a position in an array, element_styles. Thank to Adam Bratt for help getting this to work.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">function</span> <span class="nx">loopChildrenGrab</span><span class="p">(</span><span class="nx">this_ele</span><span class="p">,</span> <span class="nx">styles</span><span class="p">,</span> <span class="nx">element_styles</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">element_styles</span><span class="p">[</span><span class="nx">index</span><span class="p">]</span> <span class="o">=</span> <span class="nx">getStyles</span><span class="p">(</span><span class="nx">this_ele</span><span class="p">,</span> <span class="nx">styles</span><span class="p">);</span>
</span><span class='line'>    <span class="nx">index</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span> <span class="nx">$</span><span class="p">(</span><span class="nx">this_ele</span><span class="p">).</span><span class="nx">children</span><span class="p">().</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">$</span><span class="p">(</span><span class="nx">this_ele</span><span class="p">).</span><span class="nx">children</span><span class="p">().</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
</span><span class='line'>            <span class="nx">loopChildrenGrab</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">styles</span><span class="p">,</span> <span class="nx">element_styles</span><span class="p">);</span>
</span><span class='line'>        <span class="p">});</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">return</span> <span class="nx">element_styles</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now we have a multidimensional array of every single elements style, order by the elements position in the DOM. So we can delete the whole web page that we loaded at first, and then run the reverse of the previous functions to assign each CSS property to our copied HTML:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">function</span> <span class="nx">pushStyles</span><span class="p">(</span><span class="nx">ele</span><span class="p">,</span> <span class="nx">styles</span><span class="p">,</span> <span class="nx">values</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">styles</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">$</span><span class="p">(</span><span class="nx">ele</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="nx">styles</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">values</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kd">function</span> <span class="nx">loopChildrenPush</span><span class="p">(</span><span class="nx">this_ele</span><span class="p">,</span> <span class="nx">styles</span><span class="p">,</span> <span class="nx">element_styles</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">pushStyles</span><span class="p">(</span><span class="nx">this_ele</span><span class="p">,</span> <span class="nx">styles</span><span class="p">,</span> <span class="nx">element_styles</span><span class="p">[</span><span class="nx">count</span><span class="p">]);</span>
</span><span class='line'>    <span class="nx">count</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span> <span class="nx">$</span><span class="p">(</span><span class="nx">this_ele</span><span class="p">).</span><span class="nx">children</span><span class="p">().</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nx">$</span><span class="p">(</span><span class="nx">this_ele</span><span class="p">).</span><span class="nx">children</span><span class="p">().</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>            <span class="nx">loopChildrenPush</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">styles</span><span class="p">,</span> <span class="nx">element_styles</span><span class="p">);</span>
</span><span class='line'>        <span class="p">});</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Tada! We now have successfully copied the HTML and flattened the CSS for each element. s_BREAKING_NEWS_BOX can now be loaded independently of its parent page.</p>

<p>What would it take to do this server-side? In short, render the HTML in some sort of web view, then extract the flattened CSS for every element. While it is possible, and most likely the way to proceed with this project, letting the browser do the heavy lifting rendering CSS is definitely easier in the short term.</p>

		
		
	</div>
</article>

<nav id="pagenavi">
    
        <a href="/" class="prev">Prev</a>
    
    
    <div class="center"><a href="/blog/archives">Blog Archives</a></div>
</nav></div>
	<footer id="footer" class="inner">Copyright &copy; 2013

    Nathan Cahill

</footer>
	<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->


<script type="text/javascript">
      var disqus_shortname = 'nathancahill';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-29405367-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>



</body>
</html>